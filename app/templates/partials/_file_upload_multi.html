{# Partial template per upload file multi-content #}
{# Usage: {% include 'partials/_file_upload_multi.html' %} #}

<div id="file-upload-section" class="space-y-4">
    {# Software Files #}
    <div class="file-upload-type" data-content-type="software" style="display:none;">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                <span class="material-icons mr-2">code</span>
                Carica File Codice Sorgente
            </h4>
            <input type="file" name="files" multiple 
                   accept=".py,.js,.ts,.jsx,.tsx,.cpp,.c,.h,.java,.go,.rs,.rb,.php,.html,.css,.json,.xml,.yml"
                   class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-100 file:text-blue-800 hover:file:bg-blue-200">
            <p class="text-xs text-gray-500 mt-2">File singoli o multipli. Max 10MB per file.</p>
        </div>
    </div>
    
    {# Hardware Files #}
    <div class="file-upload-type" data-content-type="hardware" style="display:none;">
        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <h4 class="font-semibold text-green-800 mb-3">üì¶ Carica File Hardware</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">File CAD / 3D Models</label>
                    <input type="file" name="files" multiple 
                           accept=".stl,.step,.stp,.dwg,.dxf,.f3d,.sldprt,.obj"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-100 file:text-green-800 hover:file:bg-green-200">
                    <p class="text-xs text-gray-500 mt-1">STL, STEP, DWG...</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Schematici / PCB</label>
                    <input type="file" name="files" multiple 
                           accept=".kicad_pcb,.kicad_sch,.brd,.sch,.gbr"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-100 file:text-green-800 hover:file:bg-green-200">
                    <p class="text-xs text-gray-500 mt-1">KiCad, Eagle, Gerber...</p>
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-2">Max 50MB per file. ZIP file for Gerber sets.</p>
        </div>
    </div>
    
    {# Design Files #}
    <div class="file-upload-type" data-content-type="design" style="display:none;">
        <div class="bg-pink-50 border border-pink-200 rounded-lg p-4">
            <h4 class="font-semibold text-pink-800 mb-3 flex items-center">
                <span class="material-icons mr-2">palette</span>
                Carica File Design
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">File Sorgente (PSD, AI, Figma)</label>
                    <input type="file" name="files" multiple 
                           accept=".psd,.psb,.ai,.fig,.sketch,.xd,.afdesign"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-100 file:text-pink-800 hover:file:bg-pink-200">
                    <p class="text-xs text-gray-500 mt-1">Photoshop, Illustrator, Figma...</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Export (PNG, SVG, PDF)</label>
                    <input type="file" name="files" multiple 
                           accept=".png,.jpg,.jpeg,.svg,.pdf,.webp"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-100 file:text-pink-800 hover:file:bg-pink-200">
                    <p class="text-xs text-gray-500 mt-1">Immagini finali, loghi...</p>
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-2">Max 100MB per file. Includi sempre export per preview.</p>
        </div>
    </div>
    
    {# Documentation Files #}
    <div class="file-upload-type" data-content-type="documentation" style="display:none;">
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <h4 class="font-semibold text-yellow-800 mb-3 flex items-center">
                <span class="material-icons mr-2">description</span>
                Carica Documentazione
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Documenti (PDF, Word)</label>
                    <input type="file" name="files" multiple 
                           accept=".pdf,.doc,.docx,.odt,.pages"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-100 file:text-yellow-800 hover:file:bg-yellow-200">
                    <p class="text-xs text-gray-500 mt-1">PDF, DOCX, Pages...</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Presentazioni / Excel</label>
                    <input type="file" name="files" multiple 
                           accept=".ppt,.pptx,.key,.xls,.xlsx,.csv"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-100 file:text-yellow-800 hover:file:bg-yellow-200">
                    <p class="text-xs text-gray-500 mt-1">PowerPoint, Keynote, Excel...</p>
                </div>
            </div>
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Markdown / Testo</label>
                <input type="file" name="files" multiple 
                       accept=".md,.txt,.rtf"
                       class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-100 file:text-yellow-800 hover:file:bg-yellow-200">
                <p class="text-xs text-gray-500 mt-1">Markdown, plain text...</p>
            </div>
            <p class="text-xs text-gray-500 mt-2">Max 20MB per file.</p>
        </div>
    </div>
    
    {# Media Files #}
    <div class="file-upload-type" data-content-type="media" style="display:none;">
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <h4 class="font-semibold text-red-800 mb-3 flex items-center">
                <span class="material-icons mr-2">movie</span>
                Carica File Media
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Video</label>
                    <input type="file" name="files" multiple 
                           accept=".mp4,.mov,.avi,.mkv,.webm"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-100 file:text-red-800 hover:file:bg-red-200">
                    <p class="text-xs text-gray-500 mt-1">MP4, MOV, WebM...</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Audio</label>
                    <input type="file" name="files" multiple 
                           accept=".mp3,.wav,.aac,.flac,.ogg"
                           class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-100 file:text-red-800 hover:file:bg-red-200">
                    <p class="text-xs text-gray-500 mt-1">MP3, WAV, FLAC...</p>
                </div>
            </div>
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Immagini / Animazioni</label>
                <input type="file" name="files" multiple 
                       accept=".jpg,.png,.gif,.webp,.apng"
                       class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-100 file:text-red-800 hover:file:bg-red-200">
                <p class="text-xs text-gray-500 mt-1">Fotografie, GIF, animazioni...</p>
            </div>
            <p class="text-xs text-gray-500 mt-2">‚ö†Ô∏è Max 500MB per file video. Comprimi se necessario.</p>
        </div>
    </div>
    
    {# Mixed Files #}
    <div class="file-upload-type" data-content-type="mixed" style="display:none;">
        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
            <h4 class="font-semibold text-purple-800 mb-3 flex items-center">
                <span class="material-icons mr-2">folder_open</span>
                Carica File Multi-Tipo
            </h4>
            <p class="text-sm text-gray-600 mb-3">Carica qualsiasi combinazione di file per il tuo progetto completo.</p>
            <input type="file" name="files" multiple 
                   accept="*/*"
                   class="form-input block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-100 file:text-purple-800 hover:file:bg-purple-200">
            <p class="text-xs text-gray-500 mt-2">Tutti i formati supportati. Dimensioni variabili in base al tipo.</p>
        </div>
    </div>
</div>

{# File list preview #}
<div id="file-list" class="mt-4" style="display:none;">
    <h5 class="font-semibold text-gray-700 mb-2">File selezionati:</h5>
    <div id="file-list-items" class="space-y-2"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show/hide upload sections based on content type
    document.addEventListener('contentTypeChanged', function(e) {
        const contentType = e.detail.contentType;
        
        // Hide all upload sections
        document.querySelectorAll('.file-upload-type').forEach(el => {
            el.style.display = 'none';
        });
        
        // Show selected type
        const typeSection = document.querySelector(`.file-upload-type[data-content-type="${contentType}"]`);
        if (typeSection) {
            typeSection.style.display = 'block';
        }
    });
    
    // File input change handler - show file list
    document.querySelectorAll('input[type="file"][name="files"]').forEach(input => {
        input.addEventListener('change', function(e) {
            displayFileList(e.target.files);
        });
    });
});

function displayFileList(files) {
    const fileList = document.getElementById('file-list');
    const fileListItems = document.getElementById('file-list-items');
    
    if (files.length === 0) {
        fileList.style.display = 'none';
        return;
    }
    
    fileList.style.display = 'block';
    fileListItems.innerHTML = '';
    
    Array.from(files).forEach((file, index) => {
        const sizeM = (file.size / (1024 * 1024)).toFixed(2);
        const icon = getFileIcon(file.name);
        
        const fileItem = document.createElement('div');
        fileItem.className = 'flex items-center justify-between bg-gray-100 rounded-lg p-3';
        fileItem.innerHTML = `
            <div class="flex items-center gap-2">
                <span class="text-xl">${icon}</span>
                <span class="text-sm font-medium text-gray-700">${file.name}</span>
            </div>
            <div class="text-xs text-gray-500">${sizeM} MB</div>
        `;
        
        fileListItems.appendChild(fileItem);
    });
}

function getFileIcon(filename) {
    const ext = filename.split('.').pop().toLowerCase();
    const icons = {
        // Code
        'py': 'üêç', 'js': 'üìú', 'ts': 'üìò', 'html': 'üåê', 'css': 'üé®',
        // Design
        'psd': 'üñºÔ∏è', 'ai': '‚ú®', 'fig': 'üéØ', 'sketch': 'üíé',
        // 3D/CAD
        'stl': 'üìê', 'step': 'üîß', 'dwg': 'üìè',
        // Video
        'mp4': 'üé•', 'mov': 'üé¨', 'avi': 'üìπ',
        // Audio
        'mp3': 'üéµ', 'wav': 'üé∂', 'flac': 'üéº',
        // Docs
        'pdf': 'üìï', 'docx': 'üìÑ', 'pptx': 'üìä', 'xlsx': 'üìà',
        // Images
        'png': 'üñºÔ∏è', 'jpg': 'üì∑', 'svg': 'üé®', 'gif': 'üéûÔ∏è'
    };
    
    return icons[ext] || 'üìé';
}
</script>
